<!DOCTYPE html>
<html>
<head>
  <title>Internet Apps Client</title>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
</head>
<body>
    <div id="app">
        <h3>Where are you visiting? Type in a city below</h3>
        <input v-model="city"/>
        <button v-on:click="handleSearch()">Search</button>
        <div v-show="areResultsVisible()">
            <p>{{ rain ? "It'll be raining in the next 5 days - be prepared, bring an umbrella!" : "No rain forecasted in the next 5 days - no need for an umbrella :)"}}</p>
            <p>Pack for {{ temp }} weather!</p>
            <p>{{ air ? "Air pollution levels don't look great wear a mask!" : "Air pollution levels look good, no need for a mask :)"}}</p>
            <h4>Weather Overview - Next 5 Days</h4>
            <table>
                <tr>
                    <th>Date</th>
                    <th>Temperature</th>
                    <th>Wind Speed</th>
                    <th>Rainfall Level</th>
                </tr>
                <tr v-for="period in weather">
                    <td>{{ period["dt_txt"] }}</td>
                    <td>{{ (period["main"]["temp"] - 273.15).toFixed(2) }} *C</td>
                    <td>{{ (period["wind"]["speed"]).toFixed(2) }} m/sec</td>
                    <!-- <td>{{ (period["rain"]["3h"]).toFixed(2) }} mm</td> -->
                </tr>
            </table>
       </div>
    </div>
    <script>
        var app = new Vue({
            el: '#app',
            data: {
                resultsShow: false,
                city: "",
                rain: null,
                temp: null,
                air: null,
                weather: null,
            },
            methods: {
                areResultsVisible: function() {
                    return this.resultsShow
                },
                handleSearch: async function() {
                    if (this.city == "") {
                        alert("Please input a city!")
                    } else {
                        let base = "http://localhost:8080/forecast?city="
                        try {
                            let res = await fetch(base + this.city)
                            if (res.status == 200) {
                                let json = await res.json()
                                console.log(json)
                                this.rain = json["rain"]
                                this.temp = json["temp"]
                                this.air = json["mask"]
                                this.weather = json["weather"]
                                this.resultsShow = true
                            } else {
                                alert("Uh oh - theres been an issue!")
                            }
                        } catch (e) {
                            console.log(e)
                        }
                    }
                },
            }
        })
    </script>
</body>
</html>
